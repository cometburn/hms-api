//ðŸ§©Don't Edit this file.âœ¨Generated in Sat Feb 28 2026 00:54:34 GMT+0800 (Philippine Standard Time)âœ¨
model BookingAddon {
  id         Int     @id @default(autoincrement())
  booking_id Int
  booking    Booking @relation(fields: [booking_id], references: [id])

  room_id Int
  room    Room @relation(fields: [room_id], references: [id])

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  product_id Int
  product    Product @relation(fields: [product_id], references: [id])

  quantity    Int   @default(1)
  price       Float @default(0)
  total_price Float @default(0)

  // Transfer tracking
  added_before_transfer       Boolean @default(false)
  transferred_from_booking_id Int?
  original_booking_addon_id   Int? // Reference to the original addon if copied during transfer

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([booking_id])
  @@index([transferred_from_booking_id])
  @@map("booking_addons")
}

model BookingCharge {
  id         Int     @id @default(autoincrement())
  booking_id Int
  booking    Booking @relation(fields: [booking_id], references: [id])

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  room_id Int
  room    Room @relation(fields: [room_id], references: [id])

  name  String
  price Float  @default(0)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([booking_id])
  @@index([room_id])
  @@map("booking_charges")
}

model Booking {
  id           Int      @id @default(autoincrement())
  hotel_id     Int
  hotel        Hotel    @relation(fields: [hotel_id], references: [id])
  user_id      Int
  user         User     @relation(fields: [user_id], references: [id])
  room_id      Int
  room         Room     @relation(fields: [room_id], references: [id])
  room_rate_id Int
  room_rate    RoomRate @relation(fields: [room_rate_id], references: [id])

  start_datetime DateTime @default(now())
  end_datetime   DateTime @default(now())

  extra_person   Int     @default(0)
  total_price    Float
  status         String // pending, confirmed, cancelled, completed
  payment_status String? // unpaid, paid, refunded
  payment_type   String? // cash, card, online,
  note           String?

  // Transfer tracking fields
  transferred_from_booking_id Int?
  transferred_from_booking    Booking?  @relation("BookingTransfers", fields: [transferred_from_booking_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transferred_to_bookings     Booking[] @relation("BookingTransfers")
  transferred_at              DateTime?
  transfer_reason             String?
  original_room_id            Int? // Store original room for reference

  orders          Order?
  booking_addons  BookingAddon[]
  booking_charges BookingCharge[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([end_datetime])
  @@index([hotel_id, status])
  @@index([status, end_datetime])
  @@index([transferred_from_booking_id])
  @@map("bookings")
}

model Hotel {
  id      Int    @id @default(autoincrement())
  name    String
  address String

  room_type  RoomType[]
  room_rates RoomRate[]
  bookings   Booking[]
  products   Product[]
  rooms      Room[]
  orders     Order[]

  created_at DateTime    @default(now())
  updated_at DateTime    @updatedAt
  RoomPromo  RoomPromo[]
  UserHotel  UserHotel[]

  @@map("hotels")
}

model Inventory {
  id         Int     @id @default(autoincrement())
  product_id Int     @unique
  product    Product @relation(fields: [product_id], references: [id])

  quantity     Int
  reserved_qty Int @default(0)

  updated_at DateTime @updatedAt

  @@map("inventory")
}

model OrderItem {
  id Int @id @default(autoincrement())

  order_id Int
  order    Order @relation(fields: [order_id], references: [id])

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  product_id Int
  product    Product @relation(fields: [product_id], references: [id])

  quantity    Int
  price       Float   @default(0)
  total_price Float   @default(0)
  notes       String?

  // Transfer tracking
  added_before_transfer       Boolean @default(false)
  transferred_from_booking_id Int?
  original_order_item_id      Int? // Reference to original item if copied

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([order_id])
  @@index([transferred_from_booking_id])
  @@map("order_items")
}

model Order {
  id Int @id @default(autoincrement())

  hotel_id Int
  hotel    Hotel @relation(fields: [hotel_id], references: [id])

  booking_id Int?     @unique
  booking    Booking? @relation(fields: [booking_id], references: [id])

  status      String? @default("pending")
  total_price Float?
  notes       String?

  // Transfer tracking
  transferred_from_booking_id Int?

  order_items OrderItem[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([transferred_from_booking_id])
  @@map("orders")
}

model ProductMovement {
  id Int @id @default(autoincrement())

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  product_id Int
  product    Product @relation(fields: [product_id], references: [id])

  type      String @default("in")
  quantity  Int
  unit_cost Float

  source String?
  note   String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("product_movements")
}

model Product {
  id       Int   @id @default(autoincrement())
  hotel_id Int
  hotel    Hotel @relation(fields: [hotel_id], references: [id])

  name     String
  sku      String?
  category String?
  price    Float

  track_stock Boolean @default(true)
  unit        String?
  is_active   Boolean @default(true)

  inventory         Inventory?
  product_movements ProductMovement[]
  orderItems        OrderItem[]

  created_at   DateTime       @default(now())
  updated_at   DateTime       @updatedAt
  BookingAddon BookingAddon[]

  @@map("products")
}

model RoomPromo {
  id           Int      @id @default(autoincrement())
  hotel_id     Int
  hotel        Hotel    @relation(fields: [hotel_id], references: [id])
  name         String
  room_rate_id Int
  room_rate    RoomRate @relation(fields: [room_rate_id], references: [id])

  start_datetime DateTime @default(now())
  end_datetime   DateTime @default(now())

  days_of_week Int[] // 0-6 for Sunday-Saturday

  price             Float
  note              String?
  extra_person_rate Float   @default(0)
  active            Boolean @default(true)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([hotel_id, room_rate_id, name])
  @@map("room_promos")
}

model RoomRate {
  id Int @id @default(autoincrement())

  hotel_id     Int
  hotel        Hotel    @relation(fields: [hotel_id], references: [id])
  room_type_id Int
  room_type    RoomType @relation(fields: [room_type_id], references: [id])

  name              String
  rate_type         String // hourly, nightly, block
  duration_minutes  Int?
  base_price        Float
  overstay_rate     Float   @default(0)
  extra_person_rate Float
  is_dynamic        Boolean @default(false)

  room_promos RoomPromo[]
  bookings    Booking[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("room_rates")
}

model RoomType {
  id          Int     @id @default(autoincrement())
  hotel_id    Int
  hotel       Hotel   @relation(fields: [hotel_id], references: [id])
  name        String
  description String?

  room_rates RoomRate[]
  rooms      Room[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([hotel_id, name])
  @@map("room_types")
}

model Room {
  id           Int      @id @default(autoincrement())
  hotel_id     Int
  hotel        Hotel    @relation(fields: [hotel_id], references: [id])
  room_type_id Int
  room_type    RoomType @relation(fields: [room_type_id], references: [id])

  name               String
  floor              String?
  operational_status String          @default("available")
  notes              String?
  bookings           Booking[]
  booking_charges    BookingCharge[]

  created_at   DateTime       @default(now())
  updated_at   DateTime       @updatedAt
  BookingAddon BookingAddon[]

  @@unique([hotel_id, name])
  @@map("rooms")
}

model Subscription {
  id              Int       @id @default(autoincrement())
  user_id         Int
  user            User      @relation(fields: [user_id], references: [id])
  plan            String
  status          String
  starts_at       DateTime?
  ends_at         DateTime?
  trial_ends_at   DateTime?
  renewal_period  String
  payment_method  String?
  subscription_id String?
  customer_id     String?
  paid_at         DateTime?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("subscriptions")
}

model UserHotel {
  id Int @id @default(autoincrement())

  hotel_id Int
  hotel    Hotel @relation(fields: [hotel_id], references: [id])

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  owner_id Int?
  owner    User? @relation("OwnerUser", fields: [owner_id], references: [id])

  is_default Boolean @default(false)

  @@unique([hotel_id, user_id])
  @@map("user_hotels")
}

model UserType {
  id   Int    @id @default(autoincrement())
  name String
  User User[]

  @@map("user_types")
}

model User {
  id            Int     @id @default(autoincrement())
  email         String  @unique
  password      String?
  status        String
  first_name    String
  last_name     String
  refresh_token String?
  google_id     String?
  avatar        String?

  user_type    UserType @relation(fields: [user_type_id], references: [id])
  user_type_id Int

  subscriptions     Subscription[]
  bookings          Booking[]
  product_movements ProductMovement[]
  hotels            UserHotel[]
  owned_hotels      UserHotel[]       @relation("OwnerUser")

  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  BookingAddon  BookingAddon[]
  BookingCharge BookingCharge[]
  OrderItem     OrderItem[]

  @@map("users")
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
